---
title: 操作系统
date: 2024-06-03 12:40:34
tags: CS笔记
categories: CS笔记
---

# 操作系统

> 参考哔哩哔哩的课程：<https://www.bilibili.com/video/BV1YB4y1i7xe/?spm_id_from=333.337.search-card.all.click&vd_source=731595967596af37618c926a191e7811>
>
> 参考了博客：<https://lfool.gitbook.io/operating-system/untitled-1/2.-cao-zuo-xi-tong-de-si-ge-te-zheng>
>
> 参考了大纲：https://mubu.com/doc/d9TGd1--LY#m

## 第一章 操作系统概述

### 操作系统的基本概念

操作系统是资源管理程序，其作用是控制管理计算机系统的资源和程序的指向。操作系统是计算机中最基础的软件

操作系统的作用目标：

- 通过资源管理，提高计算机系统的**效率**

- 改善界面，为用户提供友好的工作环境（方便性）

---

最开始的计算机是由冯诺依曼模型构造的，有以下特点：

- **主机**：主机部分由运算器、存储器和控制器组成。

  - **运算器**：负责执行所有的算术和逻辑运算。
  - **存储器**：用于存储数据和指令。
  - **控制器**：负责解释和执行指令，并控制其他部件的操作。

  **外设**：由用户主导的输入和输出设备。

  - **输入设备**：例如键盘、打孔卡片机等，用于将数据和指令输入到计算机中。
  - **输出设备**：例如打印机、显示器等，用于将计算结果和其他信息输出给用户。

计算机需要安装指定的软件才能运行，没有软件的硬件设备被称之为**裸机**，裸机可以通过安装指定软件的方式，将至升级为虚拟机

----

操作系统是计算机系统中最基础的软件，其主要目的是管理硬件和软件资源，并提供用户和应用程序与硬件交互的接口。具体来说，操作系统的引入有以下几个主要目的：

- **合理控制计算机资源**：操作系统负责管理计算机的所有硬件资源，包括CPU、内存、存储设备和输入输出设备，确保这些资源被高效合理地分配和使用。
- **优化计算机工作流程，提高性能**：操作系统通过任务调度、多任务处理、多线程管理、内存管理和文件系统管理等方式，组织和优化计算机的工作流程，提高系统的整体性能和响应速度。
- **提供用户接口和硬件接口**：操作系统提供用户接口（如命令行界面和图形用户界面），使用户能够方便地与计算机系统交互。同时，它提供硬件抽象层，使应用程序可以通过标准接口访问底层硬件，无需关注硬件的具体实现细节。

---

如果按照不同观点来分析操作系统，有如下的情况：

**用户观点**

- **定制化设计**：根据用户所使用的不同类型的计算机，设计相应的操作系统以满足其需求。例如，桌面操作系统（如Windows、macOS）与移动操作系统（如Android、iOS）的设计会有所不同，因其面向的用户群体和使用场景不同。

**系统观点**

- 资源管理器：操作系统被视为计算机系统的资源管理器，其主要功能是管理和分配系统资源。具体包括：
  - **处理器管理**：调度和分配CPU时间，使得多个进程能够有效运行。
  - **存储器管理**：管理物理内存和虚拟内存，确保各进程能够获得所需的内存空间。
  - **设备管理**：管理输入输出设备，协调设备之间的操作。
  - **信息管理**：管理数据和文件系统，确保数据的有效存储和检索。
- **物质基础与工作环境**：操作系统本身依赖于计算机硬件，包括处理器、存储器、外设等，它们构成了操作系统赖以运行的基础。

**进程观点**

- 多进程架构 ：操作系统由多个可以独立运行的程序（进程）和一个负责协调这些程序的核心（通常是CPU）组成。
  - **用户进程**：由用户启动和使用的应用程序。
  - **系统进程**：操作系统内部用于管理和维护系统的进程。

**虚拟机观点**

- 机器扩展：操作系统本质上可以看作一个虚拟机，扩展了计算机的物理硬件，使其提供更加便捷和高级的功能。
  - **分层结构**：操作系统被设计为多个层次，每一层执行特定的功能。
  - **虚拟机服务**：通过层次化设计，操作系统为上层应用提供了一个虚拟化的工作环境，屏蔽底层硬件的复杂性，使开发和运行应用更加便捷。
  - **虚拟机在底层**：虚拟机的概念通常应用在底层，以便上层应用程序可以在一个统一和抽象的环境中运行，而不必关心底层硬件的差异。

#### 操作系统的特征

按照操作系统实现的功能，可以分为这四大特征

并发性：

- **定义**：并发性指两个或多个事件在同一时间间隔内发生。宏观上，这些事件似乎是同时发生的，但微观上，它们实际上是交替发生的。这**类似于计算机网络中的时分复用**。
- **示例**：在多任务环境中，多个进程或线程在同一时间间隔内执行任务。

共享性：

- **定义**：共享即资源共享，指系统中的资源可以被内存中多个并发执行的进程共同使用。
- 资源共享的方式
  - **互斥共享**：某些资源虽然可以被多个进程使用，但在任何时间点，只允许一个进程访问。例如，打印机和磁带机。
  - **同时共享**：某些资源允许在同一时间段内被多个进程同时访问。例如，磁盘和内存。

虚拟性：

- **定义**：虚拟性是指将一个物理实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑对应物是用户感受到的。
- 示例
  - **虚拟存储技术（空分复用技术）**：在一个具有4 GB内存的电脑上，可以运行远大于4 GB内存的程序。
  - **虚拟处理器技术（时分复用技术）**：在单核计算机上，可以同时运行多个程序。

异步：

- **定义**：异步性指程序执行的顺序和时间是不可预知的。程序的执行可能会因为各种原因被中断或延迟，但最终会在有限时间内完成。
- 其指的是程序中的某些操作可以在**等待特定条件**（如I/O操作完成、网络请求返回数据、计时器到期等）**满足之前**，让程序继续执行其他任务。一旦这些条件满足，等待的操作就会被触发和执行。

----

并发性和共享性是操作系统最基本的特征，二者互为存在条件

#### 操作系统的五大基本功能

**处理器管理**

- 进程控制
  - 创建、终止进程。
  - 管理进程的状态和上下文切换。
- 进程通讯
  - 进程间通信（IPC）机制，如管道、消息队列、共享内存和信号等。
- 进程同步
  - 通过信号量、互斥锁、条件变量等机制，保证多个进程或线程在访问共享资源时不发生冲突。
- 进程调度
  - 使用调度算法（如先来先服务、最短作业优先、轮转法等）分配CPU时间给各进程，保证系统高效运行。

---

**存储器管理**

- 内存分配
  - 动态分配和释放内存空间，使用如分区分配、页式分配和段式分配等技术。
- 内存保护
  - 防止一个进程访问另一个进程的内存空间，确保系统稳定性和安全性。
- 内存扩充
  - 通过虚拟内存技术扩展物理内存的容量，使程序能够运行超出物理内存限制的任务。

---

**设备管理**

- 设备分配
  - 动态分配设备给各进程使用，保证设备的高效利用。
- 设备传输控制
  - 管理设备的数据传输，提供中断处理和DMA（直接存储器访问）等机制。
- 设备独立性
  - 提供统一的设备接口，使得应用程序不需要关心底层设备的具体实现。

---

**文件管理**

- 文件存储空间管理
  - 管理磁盘空间的分配和回收，使用如文件分配表（FAT）、索引节点（inode）等结构。
- 文件目录管理
  - 管理文件和目录的层次结构，提供路径名解析和目录操作。
- 文件操作管理
  - 提供文件的创建、删除、读写、重命名等基本操作接口。
- 文件保护
  - 通过访问控制列表（ACL）、权限设置等机制，保证文件的安全性和隐私性。

---

**用户接口**

> 命令接口

- **定义**：提供命令行界面（CLI），用户可以通过输入命令与操作系统进行交互。
- 类型
  - **联机命令接口**：用户通过终端或控制台实时输入和执行命令，操作系统即时响应。例如，UNIX shell或Windows命令提示符。
  - **脱机命令接口**：用户编写批处理脚本或命令文件，操作系统在后台或在指定时间执行这些命令。例如，批处理脚本（.bat文件）或shell脚本（.sh文件）。

> 程序接口

- **定义**：提供系统调用和API，使程序能够访问操作系统的功能和资源。
- 功能
  - **系统调用**：操作系统为应用程序提供的一组接口，用于执行操作系统级的任务，如文件操作、进程控制、内存管理等。
  - **API（应用程序接口）**：允许程序与操作系统进行交互的函数库或接口规范。程序通过调用API函数来实现特定功能。
- 执行环境
  - **内核空间**：系统调用运行在内核空间，因此需要在用户态和核心态之间进行上下文切换。这一切换涉及状态的转换，以保证系统安全和稳定。

> 图形接口

- **定义**：提供图形用户界面（GUI），通过窗口、图标、按钮等图形元素与用户交互。
- 功能
  - **用户交互**：GUI提供直观的操作方式，用户通过图形化的控件进行操作，比如点击按钮、拖动窗口等。
  - **资源访问**：GUI为用户程序在运行过程中访问和管理系统资源提供了图形化的操作环境，使得操作系统的功能和资源更加易于访问和管理。

---

#### 操作系统的发展过程

##### 无操作系统

- 特点
  - 用户独占计算机资源：每次只有一个用户或一个程序可以使用计算机的资源。
  - 资源利用率低：由于计算机资源在用户等待输入时处于空闲状态，因此整体资源利用效率较低。
  - CPU等待用户输入：计算机的中央处理器（CPU）在用户提供输入或指令之前，通常处于等待状态，不能执行其他任务。

---

##### 单批处理系统

- **定义**：最早出现的操作系统类型，通过批处理方式自动化任务处理。
- 特点
  - **自动性**：系统自动执行一系列任务，无需用户干预。
  - **顺序性**：任务按顺序处理，每次只处理一个作业。
  - **单道性**：内存中只保留一个程序的执行，即一次只加载一道程序，其他程序在内存中等待。

---

##### 多批处理系统

- **定义**：引入了多道程序设计，改进了计算机资源的利用方式。
- **特点**：
  - **多道性**：同时在内存中保留多个程序，这些程序可以在等待I/O操作或其他事件时使CPU继续执行其他任务。
  - **宏观上并行**：多个程序的执行看起来是并行的，因为它们共享CPU资源。
  - **微观上串行**：在任意时刻，CPU实际上只处理一个程序的任务，通过快速切换实现“并行”。
- **优点**：
  - **资源利用率高**：多个程序共享计算机资源，使得CPU和其他硬件资源保持忙碌状态，减少了资源的闲置时间。
  - **系统吞吐量大**：由于多个程序并行处理，系统的吞吐量（单位时间内处理的作业数量）显著提高。
  - **切换开销小**：仅在程序完成或需要进行切换时，才进行上下文切换，相比频繁的用户交互，系统开销较小。
- **缺点**：
  - **用户响应时间长**：由于程序在等待队列中，用户可能需要等待较长时间才能获得系统响应。
  - **缺乏人机交互能力**：用户无法实时了解计算机的运行情况，也无法直接控制计算机的执行流程。

### 操作系统的分类

#### 批处理操作系统

- **特点**：
  - **用户脱机使用**：用户在离线状态下提交作业，操作系统会自动处理这些作业。
  - **成批处理**：作业被集中到一起形成一个批次，操作系统将整个批次中的作业逐个处理。这里的“批”指的是一组作业的集合。
  - **多道程序运行**：系统内存中可以同时存在多个作业，每个作业在不同的时间段占用CPU资源。
- **说明**：
  - **作业**：包括程序、数据和作业说明书。作业说明书描述了作业的处理要求和资源需求。
  - **监督程序**：操作系统中配置的程序，用于自动管理和调度批处理作业。

---

#### 分时操作系统

- 特点
  - **时间片**：将处理器的运行时间划分为很短的时间片，系统按时间片轮流分配给各个联机作业。
  - 实现方法
    - **简单分时操作系统**：基本的分时机制，处理多个用户任务。
    - **前台和后台分时操作系统**：前台处理用户交互任务，后台处理后台作业。
    - **多道分时操作系统**：同时支持多个用户的交互操作与后台作业的处理。
- 特征
  - **多路性**：在微观上，各用户轮流使用计算机；在宏观上，各用户并行工作。
  - **交互性**：用户可以直接控制和交互自己的程序，以人机对话的方式进行操作。
  - **独立性**：各用户的操作相互独立，不会干扰或混淆。
  - **及时性**：系统能够快速响应用户请求，相比批处理系统响应时间更短。

---

#### 实时操作系统

**类型**：

- **实时工业控制系统**：用于工业自动化和控制系统，需要高可靠性和及时响应。
- **实时信息处理系统**：处理实时数据流，如金融交易系统。
- **实时多媒体系统**：支持音频、视频等多媒体应用，要求低延迟。
- **实时嵌入式系统**：嵌入到硬件中，用于特定的实时任务，如汽车控制系统。

**特点**：

- **及时性**：能够在规定的时间内完成任务，并对事件做出迅速响应。
- **可靠性**：系统具备多级容错措施，确保在各种条件下稳定运行。
- **过载防护能力**：能够处理高负荷条件下的任务，保持系统稳定性。
- **支持多道程序设计**：提高系统利用率和吞吐量。
- **交互性**：能够处理实时用户交互请求。

**特征**：及时性和可靠性是实时系统的主要特征。

---

#### 其他操作系统

- **嵌入式操作系统**：
  - 专为嵌入式设备设计，通常用于特定的硬件，如家用电器、汽车等。特点是资源占用少、实时性强。
- **集群操作系统**：
  - **定义**：多个独立的计算机系统通过网络连接起来，协同完成一个任务。
  - **特点**：提供负载均衡、容错和高可用性，确保系统的整体性能和可靠性。
- **网络操作系统**：
  - **定义**：管理网络中计算机资源的操作系统。
  - 特点
    - **互联计算机系统**：网络中多个计算机互相连接。
    - **自洽性**：每台计算机能够独立运行。
    - **通信设备**：通过网络设备（如路由器、交换机）实现计算机间的通信。
    - **资源共享**：实现网络资源的共享和访问。
- **分布式操作系统**：
  - **定义**：将处理单元分布在多个物理位置，通过网络连接实现统一的系统。
  - 特点
    - **统一性**：为用户提供统一的操作体验。
    - **共享性**：系统资源可以被网络中多个计算机共享。
    - **透明性**：系统隐藏了分布式计算的复杂性，使得用户像使用单一计算机一样操作。
    - **自治性**：每个节点具有一定的自治能力，同时支持分布式环境中的协作。
    - **可靠性**：通过冗余和容错机制提升系统的整体可靠性。

> 分时操作系统和实时操作系统的区别：
>
> - **分时操作系统** 主要关注多用户交互和资源利用效率，通过时间片轮转使多个用户可以公平地访问计算机资源。
> - **实时操作系统** 主要关注任务的及时性和可靠性，通过优先级调度和中断处理保证任务能在严格的时间限制内完成。

### 操作系统运行环境

#### 处理器执行状态

> 核心态（内核态、系统态）

- **定义**：操作系统管理程序执行时机器的状态，具有最高的权限级别。
- 特性
  - **权限**：可以执行所有指令，包括特权指令（如直接访问硬件、控制内存保护等）。
  - **访问范围**：可以访问所有寄存器和内存区域，执行任意操作。
  - **职责**：处理系统调用、硬件中断、异常处理、系统资源管理等关键任务。

> 用户态（用户态）

- **定义**：用户程序执行时机器的状态，权限级别较低。
- 特性
  - **权限**：只能执行受限的指令，不能执行特权指令。
  - **访问范围**：只能访问有限的寄存器和内存区域，不能直接访问核心态资源。
  - **职责**：执行用户应用程序的逻辑，处理用户数据和应用层任务。

> 从用户态切换到核心态

- **机制**：用户程序不能直接调用核心态的功能，必须通过特定的机制进行切换。
- 方法
  - **系统调用**：用户程序通过系统调用请求操作系统服务，例如文件操作、进程管理等。系统调用会触发一个软中断，操作系统从用户态切换到核心态。
  - **中断**：硬件中断（如输入设备的信号）会使系统从用户态切换到核心态，以处理设备的请求。
  - **异常**：用户程序发生错误（如非法操作、除零错误）会触发异常，系统从用户态切换到核心态进行处理。
  - **特权指令**：用户程序尝试执行特权指令（如访问受保护的内存区域）会触发中断或异常，系统从用户态切换到核心态。
  - **中断返回指令**：系统在处理完请求后，通过中断返回指令将控制权从核心态切换回用户态，恢复用户程序的执行。
  - **仿管指令**：某些系统支持仿管指令用于模拟核心态功能，通常用于虚拟化环境。

#### 内核指令

> 时钟管理

- **定义**：时钟是操作系统中最关键的设备之一。
- 功能
  - **计时**：提供系统时间和跟踪操作的持续时间。
  - 时钟中断用于进程调度和系统维护。通过定期的时钟中断，操作系统可以实现：
    - **进程切换**：在多任务环境中，时钟中断触发的调度程序决定何时将CPU从当前进程切换到下一个进程。
    - **时间片管理**：确保每个进程或任务获得公平的CPU时间片，以实现多道程序的高效运行。

> 中断机制

- **定义**：中断机制是操作系统中用于响应外部事件和内部请求的基本机制。
- 发展
  - **早期**：最初，中断机制用于提高多道程序环境下的CPU利用率，主要用于响应外部设备的信号。
  - 现代中断机制已成为操作系统的核心，支持各种操作，包括：
    - **硬件中断**：来自外部设备的信号，如键盘输入、网络数据包。
    - **软件中断**：由程序或操作系统发出的信号，用于系统调用和异常处理。

> 原语

- **定义**：原语是操作系统中执行基本操作的小程序，它们通常是关闭中断或执行特定任务的代码。
- 特征
  - **接近硬件**：直接操作硬件或系统内部状态。
  - **原子性**：操作必须一次性完成，不允许中断，确保数据一致性和系统稳定性。
  - **运行时间短**：原语执行迅速，以减少对系统性能的影响，并且经常被调用以实现高效的操作。

#### 中断与异常

##### **中断（外中断）**

- **定义**：中断是系统正常操作的一部分，用于响应外部事件。
- 来源
  - **外设请求**：例如，输入设备、网络适配器发出的信号。
  - **人的干预**：如键盘中断或用户请求。
- **特征**：中断可以是预期的事件，旨在通知操作系统有需要处理的外部事件。

![image-20240622192715954](06-03-操作系统/image-20240622192715954.png)

![image-20240622192737575](06-03-操作系统/image-20240622192737575.png)

##### **异常（内中断）**

- **定义**：异常是由系统错误或异常情况引起的中断。
- 来源
  - **文件损坏**：例如，尝试访问受损的文件。
  - **进程越界**：如访问非法内存地址。
  - **算术溢出**：例如，整数溢出或除零错误。
  - **硬件故障**：如硬件组件出现故障。
  - **软件中断**：程序故意触发的软件中断请求。
- **特征**：异常通常是不预期的，指示系统出现了错误或问题。

- **区别**：异常是中断的一种特殊形式，主要由于错误或不正常的情况触发，而中断不一定是由异常引起的，它可以是外部设备的正常请求或用户操作。

---

##### 中断处理过程

1. **关中断**：禁用中断，以防止在处理中断时发生新的中断。
2. **保存断点**：保存当前执行状态，以便在中断处理完后能够恢复。
3. **中断服务程序寻址**：定位和准备执行相应的中断服务程序。
4. **保存现场和屏蔽字**：保存当前寄存器和状态信息，并屏蔽中断，以保证处理过程中不会被干扰。
5. **开中断**：重新启用中断，以便在处理过程中可能产生的新的中断能被处理。
6. **执行中断服务程序**：执行中断服务程序以处理具体的中断请求。
7. **关中断**：禁用中断，以确保在恢复现场时不会有新的中断干扰。
8. **恢复现场和屏蔽字**：恢复保存的寄存器和状态信息，并恢复中断屏蔽状态。
9. **开中断，中断返回**：重新启用中断，并返回到中断发生之前的程序执行点。

- 说明
  - **步骤 1~3**：由硬件（中断控制器）自动完成。
  - **步骤 4~9**：由中断处理程序完成，以确保系统在处理中断后能够正确恢复并继续运行。

#### 系统调用

**定义**：系统调用是用户程序通过操作系统提供的接口请求特权服务或资源的机制。系统调用允许用户程序执行需要核心态权限的操作。

目的是请求系统资源。指运行在用户空间的程序向操作系统内核请求需要更高权限运行的服务。系统调用提供了用户程序与操作系统之间的接口。

**设备管理**：

- **功能**：处理设备的请求、释放和启动等操作。
- **示例**：读取磁盘数据、写入打印机、控制网络接口。

**文件管理**：

- **功能**：处理文件的创建、读取、写入和删除等操作。
- **示例**：打开文件、读取文件内容、写入数据到文件、删除文件。

**进程控制**：

- **功能**：管理进程的生命周期，包括创建、终止、阻塞和唤醒等操作。
- **示例**：启动新进程、终止进程、挂起进程、恢复进程执行。

**进程通信**：

- **功能**：实现进程之间的信息传递或信号交换，以支持进程间协作。
- **示例**：发送和接收消息、信号量操作、共享内存的创建和访问。

**内存管理**：

- **功能**：管理内存的分配和回收，包括跟踪作业占用的内存区域。
- **示例**：分配内存块、释放内存、查询内存使用情况、获取内存区域的起始地址和大小。

![image-20240622192538842](06-03-操作系统/image-20240622192538842.png)

### 操作系统的体系结构

#### 模块组合结构

**优点**

- 结构紧密，接口简单直接
- 系统的效率相对较高

**缺点**

- 系统结构不清晰
- 可扩展性较差
- 可适应性差
- 只适用于系统小、模块少、使用环境比较稳定的系统

#### 层次结构

**特点**

- 模块之间单向调用和单向依赖

**优点**

- 使模块间的组织和依赖关系清晰明了
- 便于修改和扩充

**缺点**

- 必须将与机器特点紧密相关的软件（如中断处理、输入/输出管理）放在最底层
- 常用操作应放在最内层，而变化较多的操作应放在外层
- 系统调用模块提供进程服务的部分应放在系统内层
- 系统效率可能降低

#### 微内核结构

**微内核结构**由一个非常简单的硬件抽象层和一组比较关键的原语或系统调用组成，这些原语仅仅包括了建立一个系统必需的几个部分，如线程管理、地址空间和进程间通信等。其他的管理程序则尽可能地放在内核之外。

> 把操作系统中更多的成分和功能放到更高的层次(即用户模式)中去运行，而留下一个尽量小的内核，用它来完成操作系统最基本的核心功能，这种技术被称为微内核技术。

**特点**

- 在操作系统内核中只保留基本功能，将其他服务分离出去，通过若干个用户态进程（服务器进程）实现，形成C/S模式

**优点**

- 可靠性高
- 灵活性好
- 便于维护
- 适合分布式处理的计算环境

**缺点**

- 效率不高（尤其是通信频繁的系统）

![image-20240622192938379](06-03-操作系统/image-20240622192938379.png)

## 第二章 进程与线程

### 前趋图

前驱图（即控制流图或依赖图）可以帮助我们更好地描述和控制程序的并发执行：

![image-20240622193241729](06-03-操作系统/image-20240622193241729.png)

- **资源共享管理**
  前驱图可以描绘进程间的依赖关系，帮助管理和协调资源共享，以避免竞争条件和死锁问题。
- **状态管理**
  通过前驱图，能够清晰地识别进程的执行顺序和依赖关系，从而有效地控制进程状态，保证系统的一致性和稳定性。
- **调度与同步**
  前驱图有助于设计和优化进程调度策略，确保并发进程在正确的顺序和时机下执行，并进行必要的同步操作。

### 进程的引入

进程是计算机系统中资源分配和独立运行的基本单位。**一个进程包含程序代码及其当前活动状态**，也就是**进程是执行中的程序。**

![image-20240721211856962](06-03-操作系统/image-20240721211856962.png)

程序的顺序执行： **程序在顺序执行时，只有前一个操作执行完成后**，后续操作才能执行。

- 顺序性：操作按既定顺序依次进行。
- 封闭性：程序运行期间，结果不受外界影响，独占系统资源。
- 可再现性：初始条件和执行环境相同，程序重复执行会得到相同结果。

程序的并发执行： **多个程序（程序段）同时在系统中运行。**

- 间断性：程序共享资源或相互协作，形成相互制约关系。
- 失去封闭性：多个程序共享系统资源。
- 不可再现性：由于共享资源和相互影响，程序执行结果可能不同。

并发执行的条件： 并发执行要求程序具有可再现性，符合 Bernstein 理想化状态：

1. 确保在两次读操作之间，存储器中的数据不发生变化。
2. 确保写操作结果不会丢失。

### 进程的定义

进程的定义与描述： 由于并发执行破坏了程序的封闭性和可再现性，引出了进程这个概念，并配置了相应的进程同步机制。

- 进程是程序在**处理器上的一次执行过程**。
- 进程是与**其他进程并行执行的计算**。
- 进程是在一个**数据集合上的运行过程**，是系统进行资源分配和调度的一个独立单位。
- 进程可定义为一个**数据结构及能在其上进行操作的一个程序**。
- 进程是一个程序关于某个数据集合在处理器上顺序执行所发生的活动。
- 进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。

进程从功能出发有以下特征：

- **动态**性: 进程是程序的一次执行过程，是动态地产生、变化和消亡的
- **并发**性: 内存中有多个进程实体，各进程可井发执行
- 独立性: 进程是能独立运行、独立获得资源、独立接受调度的基本单位
  - **进程是资源分配、接受调度的基本, 独立单位**
- **异步**性: 各进程按各自独立的、不可预知的速度向前推进，操作系统要提供"进程同步机制"来解决异步问题
- **结构**性: 每个进程都会配置一个PCB。结构上看，进程由PCB、程序段、数据段组成

进程和程序的关系：

- 进程是动态的，程序是静止的。
- 每个进程包含程序段、数据段以及进程控制块（PCB），而程序是有序代码的集合。
- 进程是暂时的，程序是永久的。
- 一个程序通过多次执行可以产生多个不同的进程；通过调用关系，一个进程可以执行多个程序，而程序不能形成新的程序。
- 进程具有并行特性（独立性、异步性），而程序没有。

> 进程实体（映像）包括：
>
> - 程序段
> - 相关数据段
> - 进程控制块（PCB），它是进程存在的唯一标志。

---

进程和作业的区别：**作业**是用户需要计算机**完成某项任务而要求计算机所做的工作的集合**。

> - 作业是用户向计算机提交任务的任务实体。
> - 进程是完成用户任务的执行实体。
> - 一个作业由至少一个进程组成，但一个进程不能构成多个作业。

完成作业过程：作业提交。作业收容。作业执行。作业完成。

### 进程的基本概念

进程的特征:

- 动态性：进程是程序在处理器上的一次执行过程，因而是动态的(动态性是进程的最基本的特征)
- 并发性：指多个进程实体同时存于内存中，能在一段时间内同时运行
- 独立性：是指进程实体是一个能独立运行、独立获得资源和独立接受调度的基本单位
- 异步性：进程按照各自独立运行的、不可预知的速度向前推进
- 结构性：从结构上看，进程实体是由程序段、数据段和进程控制块(PCB)三部分组成的。

> 程序段:是指程序的代码
> 数据段:是指运行过程中产生的各种数据

#### 进程控制块(PCB)

PCB：是进程实体的重要组成部分，其中记录了用于描述进程情况及控制进程运行所需要的全部信息。通过PCB，使得原来不能并发执行的程序，成为能并发执行的进程。在进程的控制和管理中，随进程的创建而建立PCB。

因进程的状态变化而修改PCB的相关内容;当进程被撤销时，系统收回其PCB。可见系统是根据PCB来感知进程的存在的，PCB是进程存在的唯一标志，一个进程只能有一个进程控制块。

![image-20240622194634874](06-03-操作系统/image-20240622194634874.png)

#### 进程控制块的组织方式

![image-20240622194724520](06-03-操作系统/image-20240622194724520.png)

### 进程的基本状态

**进程有五种基本状态：**

**创建状态**

- **描述**：进程初始化阶段，操作系统为进程分配资源并创建其PCB。若系统资源不足，进程处于创建状态，无法进入就绪状态。
- **过程**：申请空白PCB → 填写控制信息 → 分配资源 → 转入就绪状态（若资源足够）。

**就绪状态**

- **描述**：进程已获得除处理器以外的所有资源，等待CPU分配。
- **特征**：在就绪队列中等待调度。

**执行状态**

- **描述**：进程正在使用CPU执行任务。
- **别名**：运行状态。

**阻塞状态**

- **描述**：进程等待某些事件发生，如I/O操作完成或资源释放。
- **别名**：等待状态。即使得到CPU，也无法继续执行。

**结束状态**

- **描述**：进程正常或异常结束，操作系统进行善后处理，清除PCB并释放资源。

![image-20240622194946309](06-03-操作系统/image-20240622194946309.png)

**进程状态之间的转换情况如下：**

**就绪 → 执行**

- **原因**：进程被调度程序选中，获得CPU时间片。

**执行 → 阻塞**

- **原因**：进程因等待某些事件（如I/O操作）而无法继续执行。

**执行 → 就绪**

- **原因**：时间片用完，或有更高优先级的进程变为就绪状态。

**阻塞 → 就绪**

- **原因**：所等待的事件发生，进程被唤醒，重新进入就绪队列。

#### 进程的控制

![image-20240622195053267](06-03-操作系统/image-20240622195053267.png)

#### 进程状态转换的过程

![image-20240622195124802](06-03-操作系统/image-20240622195124802.png)

### 进程通信

进程间通信（IPC）是操作系统提供的一种机制，用于实现不同进程之间的信息交换。根据通信方式的不同，进程间通信可以分为低级通信方式和高级通信方式。

#### **低级通信方式**

1. **互斥**
   - **目的**：防止多个进程同时访问共享资源而导致数据不一致或冲突。
   - **实现方式**：使用互斥锁（mutex）、信号量（semaphore）等同步原语来确保同一时刻只有一个进程可以访问共享资源。
2. **同步**
   - **目的**：协调进程之间的执行顺序，确保按预期顺序执行任务。
   - **实现方式**：使用条件变量、信号量等机制来实现进程间的同步，以确保某些操作在特定条件下才执行。

#### **高级通信方式**

**共享存储器系统**

![image-20240622195422825](06-03-操作系统/image-20240622195422825.png)

- **描述**：多个进程通过访问同一块共享内存区域来进行通信。
- 过程
  - **创建共享存储区**：操作系统分配一块内存区域，供多个进程共享。
  - **读写操作**：进程可以在共享内存中读写数据，实现信息传递。
- **优点**：通信效率高，因直接内存访问不需要进行数据拷贝。
- **挑战**：需要使用同步机制来避免对共享内存的并发访问导致的数据冲突。

**消息传递系统**

![image-20240622195545798](06-03-操作系统/image-20240622195545798.png)

- **描述**：进程通过发送和接收消息来进行通信。
- 方式
  - **直接通信**：发送进程直接指定接收进程，消息直接传送给目标进程。
  - **间接通信**（信箱通信）：使用中间的消息队列或信箱，发送进程将消息放入信箱，接收进程从信箱中取出消息。这种方式支持多个进程的间接通信。

**管道通信系统**

![image-20240622195522216](06-03-操作系统/image-20240622195522216.png)

- **描述**：通过管道（也称为管道文件或pipe）实现进程间的通信。
- 过程
  - **创建管道**：创建一个管道文件，用于读写数据。
  - **数据传输**：一个进程将数据写入管道，另一个进程从管道读取数据。
- **特点**：管道通常用于同一系统中的进程间通信，必须保证通信的双方已经存在（即管道的创建和使用需要在进程间协调）。

### 线程的基本概念

> 可以把线程理解为“轻量级进程”

线程是**基本的CPU执行单元，也是程序执行流的最小单位**。

引入线程后，不仅可以在不同进程之间实现并发，而且**同一进程内的各个线程也可以并发执行**。这**提升了系统的并发度**，使得进程内能够同时处理多种任务，例如视频聊天、文字聊天和文件传输等。

引入线程的作用在于**将进程作为系统资源的分配单元**（如打印机、内存地址空间等），而**线程则作为调度的基本单位**。即，**进程是资源分配的基本单位，线程是调度的基本单位**。

- 每个线程都有一个线程ID和线程控制块（TCB）。
- **线程切换时无需切换进程环境**。
- 线程本身几乎不拥有系统资源。
- 同一进程内的线程可以共享进程资源，并且线程间的通信无需系统干预。

![image-20240622195816397](06-03-操作系统/image-20240622195816397.png)

#### 线程实现

**用户级线程 (User-Level Thread, ULT)**：

- 由应用程序通过线程库实现。
- 线程的管理（包括线程切换）完全由应用程序负责。
- 线程切换在用户态下完成，无需操作系统干预。
- 对用户来说，存在多个线程；对操作系统内核来说，线程的存在是不透明的（用户级线程对用户透明，对操作系统透明）。

**内核级线程 (Kernel-Level Thread, KLT)**：

- 由操作系统内核负责管理。
- 线程调度和切换都在核心态下完成。
- 线程的管理和切换由内核完成，因此需要操作系统的参与。

#### 多线程模型

**多对一模型**：

- 将多个用户级线程映射到一个内核级线程。每个用户进程只有一个内核级线程。
- 优点
  - 用户级线程切换在用户空间完成，减少了系统开销，提高了效率。
- 缺点
  - 如果一个用户级线程被阻塞，整个进程都会被阻塞，导致并发度降低。无法在多核处理机上并行运行多个线程。

**一对一模型**：

- 每个用户级线程对应一个内核级线程。每个用户进程拥有与用户级线程数量相同的内核级线程。
- 优点
  - 一个线程被阻塞时，其他线程仍可继续执行，提供了更强的并发能力。支持多核处理机上的线程并行执行。
- 缺点
  - 一个用户进程占用多个内核级线程，线程切换需在核心态完成，增加了管理成本和系统开销。

**多对多模型**：

- 多个用户级线程映射到多个内核级线程 (n ≥ m)。每个用户进程可以有多个内核级线程。
- 优点
  - 解决了多对一模型的并发度不足问题，同时避免了一对一模型中用户进程占用过多内核级线程的问题。兼具高并发性和较低的管理开销。

#### 线程优缺点

![image-20240622195851577](06-03-操作系统/image-20240622195851577.png)

### 线程和进程比较区别

![image-20240622195915859](06-03-操作系统/image-20240622195915859.png)

### 调度的基本概念

#### **高级调度（作业调度）**

- **定义**：高级调度负责将作业从外存（辅存）调入内存。由于内存空间有限，不能将所有作业一次性加载进内存，因此需要按照一定的规则来决定哪些作业应优先加载。
- 操作
  - 从外存中的后备队列中挑选作业，将其加载到内存。
  - 为每个作业分配内存和其他必要资源，并建立进程控制块（PCB）。
  - 作业调入时会创建PCB，作业完成后会销毁PCB。
- **关注点**：主要关注如何将作业调入内存。调出操作由作业运行结束触发。

#### **中级调度（内存调度）**

- **定义**：中级调度决定哪些处于挂起状态的进程需要被重新调入内存。调度的频率高于高级调度，因为一个进程可能被多次调入和调出内存。
- 操作
  - 引入虚拟存储技术后，可以将暂时无法运行的进程转移至外存，待内存有空闲时再调入内存。
  - 被挂起的进程状态记录在内存中的PCB中，PCB本身不会被调出内存。PCB包含进程在外存中的位置及状态等信息。
  - 操作系统通过内存中的PCB管理挂起队列，维护对进程的监控和管理。

#### **低级调度（进程调度）**

- **定义**：低级调度负责从就绪队列中选择一个进程，并将处理器分配给它。是操作系统中最基本的调度类型。
- 操作
  - 根据调度策略选择一个就绪进程，分配CPU资源。
  - 进程调度的频率很高，一般在几十毫秒内发生一次。
- **关注点**：确保系统中的处理器资源得到有效利用，通过合理的调度策略来优化系统性能。

![image-20240622200131180](06-03-操作系统/image-20240622200131180.png)

#### 衡量调度算法的性能指标

![image-20240622200253748](06-03-操作系统/image-20240622200253748.png)

### 进程调度

![image-20240622200345415](06-03-操作系统/image-20240622200345415.png)

**功能**：

1. **记录进程状态**：跟踪系统中所有进程的状态和特征。
2. **选择进程**：决定哪个进程获得处理器资源。
3. **分配处理器**：将处理器资源分配给选择的进程。

**引起进程调度的原因**：

1. **当前进程结束**：进程运行完成。
2. **进程阻塞**：当前进程因等待事件而进入阻塞状态。
3. **系统调用返回**：系统调用执行完毕，返回用户进程。
4. **高优先级进程请求**：抢占式调度系统中，优先级更高的进程要求使用处理器。
5. **时间片用完**：分时系统中，时间片耗尽触发调度。

**不能调度的情况**：

1. **处理中断**：处理器正处理中断时。
2. **内核临界区**：在操作系统内核程序的临界区中。
3. **原子操作**：进行需要完全屏蔽中断的原子操作时。

**调度方式**：

1. **抢占式调度**：允许系统在任何时刻中断当前运行的进程，并将处理器分配给其他优先级更高的进程。
2. **非抢占式调度**：进程一旦获得处理器，除非其主动放弃或完成执行，否则不会被中断。

![image-20240622200408019](06-03-操作系统/image-20240622200408019.png)

**进程调度的任务与方式**

![image-20240622200449686](06-03-操作系统/image-20240622200449686.png)

### 典型调度算法

#### 典型调度算法：先来先服务调度算法(FCFS)

![image-20240622200626956](06-03-操作系统/image-20240622200626956.png)

#### 典型调度算法：短作业有限调度算法(SJF)

![image-20240622200755437](06-03-操作系统/image-20240622200755437.png)

#### 典型调度算法：高响应比有限调度算法(HRRN)

![image-20240622202037455](06-03-操作系统/image-20240622202037455.png)

#### 典型调度算法：时间片轮调度算法(RR)

![image-20240622202425887](06-03-操作系统/image-20240622202425887.png)

#### 典型调度算法：优先级调度算法(PAS)

![image-20240622202503102](06-03-操作系统/image-20240622202503102.png)

#### 典型调度算法：多级反馈队列调度算法(MFQ)

![image-20240622202555944](06-03-操作系统/image-20240622202555944.png)

#### 总结

![image-20240622202644856](06-03-操作系统/image-20240622202644856.png)

### 上下文及其切换机制

![image-20240622203003475](06-03-操作系统/image-20240622203003475.png)

![image-20240622203014210](06-03-操作系统/image-20240622203014210.png)

## 第二章(下) 互斥和同步

![image-20240622203736052](06-03-操作系统/image-20240622203736052.png)

#### 互斥实现方法

![image-20240622204205273](06-03-操作系统/image-20240622204205273.png)

![image-20240622204218616](06-03-操作系统/image-20240622204218616.png)

![image-20240622204311018](06-03-操作系统/image-20240622204311018.png)

### 信号量机制

![image-20240622204800191](06-03-操作系统/image-20240622204800191.png)

### 经典同步问题

#### 生产-消费者问题

![image-20240622210408252](06-03-操作系统/image-20240622210408252.png)

#### 读者-写者问题

![image-20240622210421558](06-03-操作系统/image-20240622210421558.png)

#### 哲学家-进餐问题

![image-20240622210432654](06-03-操作系统/image-20240622210432654.png)

### 死锁的基本概念

![image-20240622210449589](06-03-操作系统/image-20240622210449589.png)

#### 预防死锁

![image-20240622210512343](06-03-操作系统/image-20240622210512343.png)

#### 死锁避免

![image-20240622210534104](06-03-操作系统/image-20240622210534104.png)

- 银行家算法

#### 死锁检测

![image-20240622210610289](06-03-操作系统/image-20240622210610289.png)

![image-20240622210633473](06-03-操作系统/image-20240622210633473.png)

## 第三章 内存管理

### 程序的装入和链接

![image-20240622211225929](06-03-操作系统/image-20240622211225929.png)

### 逻辑地址与物理地址

![image-20240622211242883](06-03-操作系统/image-20240622211242883.png)

### 内存保护

![image-20240622211305406](06-03-操作系统/image-20240622211305406.png)

### 对换和覆盖

![image-20240622211332602](06-03-操作系统/image-20240622211332602.png)

### 管理方式

#### 连续分配管理方式

![image-20240622211656675](06-03-操作系统/image-20240622211656675.png)

#### 内存分配与回收

![image-20240622211527327](06-03-操作系统/image-20240622211527327.png)

#### 分页存储管理方式

![image-20240622211756010](06-03-操作系统/image-20240622211756010.png)

![image-20240622211839526](06-03-操作系统/image-20240622211839526.png)

#### 分段存储管理方式

![image-20240622212000329](06-03-操作系统/image-20240622212000329.png)

#### 段页式存储管理方式

![image-20240622213024585](06-03-操作系统/image-20240622213024585.png)

![image-20240622213047187](06-03-操作系统/image-20240622213047187.png)

## 第三章 (下)虚拟内存管理

### 虚拟存储器概述

![image-20240629204255675](06-03-操作系统/image-20240629204255675.png)

### 页框分配

### 请求分页管理方式

![image-20240629204340703](06-03-操作系统/image-20240629204340703.png)

### 页面置换算法：最佳置换算法(OPT)

![image-20240629204411888](06-03-操作系统/image-20240629204411888.png)

### 页面置换算法：先进先出算法(FIFO)

![image-20240629204437445](06-03-操作系统/image-20240629204437445.png)

### 页面置换算法：最近最久未使用算法(LRU)

![image-20240629204458843](06-03-操作系统/image-20240629204458843.png)

### 页面置换算法：时钟置换算法(CLOCK)

![image-20240629204702431](06-03-操作系统/image-20240629204702431.png)

> 页面置换算法：改进型CLOCK算法
>
> ![image-20240629204646249](06-03-操作系统/image-20240629204646249.png)

### 内存映射文件

![image-20240629204744632](06-03-操作系统/image-20240629204744632.png)

### 虚拟存储器性能影响和改进方法

![image-20240629204906336](06-03-操作系统/image-20240629204906336.png)

![image-20240629204918506](06-03-操作系统/image-20240629204918506.png)

![image-20240629204928199](06-03-操作系统/image-20240629204928199.png)

## 第四章 文件管理

![image-20240629205006560](06-03-操作系统/image-20240629205006560.png)

### 文件系统基础

#### 文件概念

![image-20240629205323100](06-03-操作系统/image-20240629205323100.png)

![image-20240629205348168](06-03-操作系统/image-20240629205348168.png)

#### 文件元数据和索引节点

#### 文件的操作

![image-20240629205358894](06-03-操作系统/image-20240629205358894.png)

#### 文件共享

#### 文件的逻辑结构

![image-20240629205409977](06-03-操作系统/image-20240629205409977.png)

![image-20240629205424945](06-03-操作系统/image-20240629205424945.png)

![image-20240629205442532](06-03-操作系统/image-20240629205442532.png)

![image-20240629205454383](06-03-操作系统/image-20240629205454383.png)

#### 文件的物理结构

![image-20240629205504999](06-03-操作系统/image-20240629205504999.png)

![image-20240629205515829](06-03-操作系统/image-20240629205515829.png)

![image-20240629205736360](06-03-操作系统/image-20240629205736360.png)

### 目录

#### 目录的基本概念

![image-20240629211046825](06-03-操作系统/image-20240629211046825.png)

![image-20240629211107805](06-03-操作系统/image-20240629211107805.png)

#### 树形目录

![image-20240629211120094](06-03-操作系统/image-20240629211120094.png)

![image-20240629231738366](06-03-操作系统/image-20240629231738366.png)

#### 目录操作

![image-20240629231428573](06-03-操作系统/image-20240629231428573.png)

#### 硬链接和软连接

![image-20240629231838146](06-03-操作系统/image-20240629231838146.png)

![image-20240629231503009](06-03-操作系统/image-20240629231503009.png)

### 文件系统

![image-20240629231927732](06-03-操作系统/image-20240629231927732.png)

#### 文件系统和全局结构

#### 外存空闲空间管理方法

![image-20240629231939392](06-03-操作系统/image-20240629231939392.png)

![image-20240629231958944](06-03-操作系统/image-20240629231958944.png)

![image-20240629232041988](06-03-操作系统/image-20240629232041988.png)

![image-20240629232051164](06-03-操作系统/image-20240629232051164.png)

![image-20240629232104442](06-03-操作系统/image-20240629232104442.png)

#### 虚拟文件系统

![image-20240629232119835](06-03-操作系统/image-20240629232119835.png)

![image-20240629232129892](06-03-操作系统/image-20240629232129892.png)

#### 文件系统挂载

![image-20240629232136889](06-03-操作系统/image-20240629232136889.png)

![image-20240629232146353](06-03-操作系统/image-20240629232146353.png)

## 第五章 OI管理(上)

![image-20240629232225192](06-03-操作系统/image-20240629232225192.png)
